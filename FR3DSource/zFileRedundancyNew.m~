
p = 0.95;                         % cutoff base match fraction

load PDBInfo

i = find(n(:,2) > 0);             % restrict to structures with nucleotides
t = t(i,:);
n = n(i,:);           

[y,i] = sort(n(:,2));             % sort by number of nucleotides
t = t(i,:);
n = n(i,:);

F = length(i);                    % number of files

close = sparse(eye(F));
prop  = sparse(eye(F));

for i = 1:(F-1),
  j = i + 1;
  while (j <= F) && (p*n(j,2) < n(i,2)),  % while seqs COULD match well enough,
    matches   = nw(t{i,9}, t{j,9}, 0.9999, 2);
    pro = matches/min(n([i j],2));
    if (n(i,2) - matches < 4) || (prop(i,j) > p),
      close(i,j) = 1;
      prop(i,j) = pro;
    end
    j = j + 1;
  end
end

close = close + close';
prop  = prop + prop';

for k = 1:20,                     % Markov transitions for transitivity
  close = close * close;
end

spy(close)

done = zeros(1,F);                % whether each file has been considered

for i = 1:(F-1),
  if done(i) == 0,
    j = find(close(i,:));         % files that are "close" to i
    if isempty(j),                % no file is close to i
      done(i) = 1;
    else
      [a,k] = sort(n(j,1));       % sort by resolution, best first
      j = j(k);
      for m = 1:length(j),
        done(j(m)) = 1;
        for n = 1:length(j),
          fprintf(' %s ', t(j(m),1));
          fprintf(' %5.2f ', prop(j(m),j(n)));
        end
        fprintf('\n');
      end
    end
  end
end

